# 模块化

## 思考

* 模块化的意义
  * 简化大型项目的维护成本
  * 在于模块可以独立的设计、开发和测试

* 模块化的工作分为 划分模块、模块组合
  * 复杂的模块化也需要管理工具
    * webpack就是一个为实现模块管理的模块打包工具(module bundler)

* 将代码段抽象为函数，会让运行和定义分开，抽象的过程算是一个维护成本。如何找到定义和运行两处算是阅读成本（虽然可以借助工具）。带来的好处是清晰区分动作之间的边界，且不需要滚动，又算是降低了阅读成本。
  * 好的抽象是有积极意义的，取有意义的名字。
  * 坏的抽象是由负面意义的，如取了意义不明的名字，或者动作代码区分不明，说不定为此增加了理解成本还不如不分。

    如果因为将代码段分割为不同函数最后导致了代码更加难懂，这不能得出将代码段拆分为函数的这个过程不可取、没有意义，如果就此得出结论，得出结论的过程就太粗暴了，首先一次实践太少，一次实践说明不了什么问题，其次这种结论建立在归因错误上，更认真的思考是：思考本次实践过程是否还有不妥的地方，如代码分割是否合理、函数命名是否都没有歧义，如果存在不妥，要思考是否是因为**实践中的不妥导致了没有积极意义**，只有排除了这种可能，才能归因到这种实践本身就没有意义。需要明确的是**本次实践中的不妥导致了本次实践结果上没有积极意义**和**因为本次实践结果上没有积极意义，所以这种实践都是没有积极意义的**这是两件事情。
* 整理的函数应该是**独立的**、能用的，最好是纯函数，且**有对应的调用示例**，不然过一段时间就忘了自己为什么要保存这段代码，所以最好把可以用到的**应用场景**一并记录。
  * **可以独立使用**
  * **有对应的调用示例**
  * **有使用场景的案例说明**

## 意义

* 一个应用作为一个整体，由很多功能组成，各个功能又有各自实现的代码，如果让人类理解一个应用，人类会倾向于去分析它提供那些功能，这个把应用分不同功能的过程就是模块化思维，可见模块化符合人的思维模式，模块化可以将降低复杂度，说明：模块化思维可以降低对复杂系统的理解成本，从而达到有效理解的目的。
* 如果一个文件代码行数太多，想找到某个功能的实现代码是较为困难的，因为行与行没有明显的区分特征，如果能够将不同的代码以功能区分存放在不同的文件，并用文件名加以区分，就可以将找到特定功能代码这个步骤所花费的时间减少，说明：合理模块化可以降低代码的维护成本
* 如果想一个功能移动到其它地方或项目使用，如果代码没有模块化，就需要找到和复制相关代码，这中间肯会需要去**阅读和辨别代码的边界**，这是理解成本，在剥离相关的代码的过程，还需要测试一些特性，判断其表现是否与新系统契合，多了一些测试成本，如果直接复制过去使用，就给后续留下了代码维护成本，未来很可能需要再一次理解这块代码。如果选择不直接复制，此时就需要将代码模块化，通过这次模块化可以便于以后复用。总结：对于需要复用的代码，模块化最好越早越好。
* 所有的代码放在一个文件，那么在滚动阅读的时候不可避免的就会看到不相关的代码，每一次滚动都产生了理解、辨别成本，每一次都要去判断当前是什么功能，当前功能代码的边界在哪，这都是理解成本，可能“面条代码”一词就是形容此类场景。前期代码行数不多可能不要紧，但是代码行数一多，滚动就成了必然操作，滚动操作的频率几何上升，在没有办法一目了然的情况下每次阅读代码都需要支付该成本，且和代码行数有关。
* 模块化本身并不会影响代码编写，反而是没有模块化的代码很难从代码结构上直观的看到与上一个版本的变化
* 总结
  * 模块化不影响代码编写
  * 分文件模块化利于版本控制系统追踪内容变化，也利于肉眼观察文件的更改时间、数量、大小对比版本差异
  * 模块化本身是有一定成本
  * 越晚模块化维护成本越高
  * 阅读、复用或维护代码时，滚动操作成本、理解成本、维护成本是需要重复支付的，且会随着代码行数、复用次数的增加而累计增加
  * 模块化降低代码的理解成本、维护成本、复用成本

## 体现

* 在操作系统中，最小模块化单元通常是文件。
* 在编程语言中，模块化大都以`function`作为最小模块化单元。
* 一些OOP语言，提供对`function`的更高级的管理和分类方式，模块化的手段变得丰富多样
* vue、angular等一类前端框架中通过`Component`组件化思维来组织代码
* angular还提供`ngModule`来管理多个组件、指令

## 何时模块化

* 以**避免滚动操作成本**作为一个原则，单文件内行数避免太多，单文件夹内同类型文件避免太多，滚动的频率越高意味着代码结构越需要优化
* 尽早明确功能边界，可以借助`function`、`<script></script>`、`文件`等方式
* 如果框架提供成熟的模块化功能应该尽早了解使用，如Vue组件、Angular模块
* 对于没有框架，也应该按功能点去拆分文件，且应该在注释描述耦合依赖关系（如果不是显而易见的），便于复用需求时无需额外了解
