# weixin

- 小程序打包实际上是压缩包，源码可以通过解压获得
- 登录公众号平台可以直接扫码选择，不需要密码登陆

## 微信开发

- 小程序

  - 审核
    - 分为两种情况，一种是对公开的小程序，一种无注册内部使用的小程序
      - 其中内部使用又分为两种，需要账号登录或者不需要账号登录
      - 内部小程序隐私设置为不允许被搜索，减少曝光率
  - 对于无账号需要登录的小程序
    - 通过配置一个 URL 路径以动态进入小程序，将审核人员要用到的参数放在 url 中
      - 这种方式是可行的
    - 在提交审核后设置一个时间可以无登录授权

- webview 与小程序之间的通信

  - url，query，锚链接
    - 应该为安全数据
  - webview 中 iframe 只能是业务域名的 URL
    - ajax 未知
    - 静态资源未知
  - websocket 通信

  - [小程序内用户帐号登录规范调整和优化建议官方](https://developers.weixin.qq.com/community/operate/doc/000640bb8441b82900e89f48351401)
    - 有推荐和不合规的登录案例
      - 授权需要由用户手动触发
      - 不能暗示或者明示用户必须要允许授权
    - 服务范围特定是指没有对外开放注册，例如教务系统、公司员工考勤系统等特定服务范围。相反地，完全对外开放注册的，且注册后即可通过小程序体验更多线上服务的，属于服务范围开放。

- wx.login()
  - 会导致上一个 session_code 失效，所以应该 wx.checkSession()确认 code 失效后再调用 wx.login
  - code 有效期是不固定的，用户使用越多则有效期会自动被更新
  - 代码
    ```js
    onLoad: function () {
    　　wx.checkSession({
    　　　　success: function(res){
    　　　　　　console.log("处于登录态");
    　　　　},
    　　　　fail: function(res){
    　　　　　　console.log("需要重新登录");
    　　　　　　wx.login({})　　
    　　　　}
    　　})
    }
    ```
